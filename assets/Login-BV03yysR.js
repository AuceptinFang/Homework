const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Cvb4EdU9.js","assets/index-BPVbfOy5.css"])))=>i.map(i=>d[i]);
import{d as M,r as w,a as q,o as j,c as _,b as s,w as r,e as u,f as k,_ as x,u as z,g as c,h as v,F as B,i as C,j as I,k as y,l as G,m as H,n as U,p as J,s as Q,E as p,q as W}from"./index-Cvb4EdU9.js";const X={class:"login-container"},Y={key:0,class:"server-status offline"},Z={key:1,class:"server-status online"},$=M({__name:"Login",setup(ee){const A=z(),V=w(),g=w(),b=w("login"),R=["admin","段鹏鹏","方震","高天全","高子涵","龚皓","霍雨婷","贾奇燠","贾一丁","金闿翎","靳宇晨","李希","刘森源","刘文晶","吕彦儒","吕泽熙","苏宗佑","汤锦健","王奕涵","王悦琳","王志成","王墨","王泽君","夏正鑫","肖俊波","杨海屹","杨孟涵","张成宇","张峻菘","张钟文","赵萌"],d=q({username:"",password:""}),l=q({username:"",password:"",confirmPassword:""}),N={username:[{required:!0,message:"请选择用户名",trigger:"change"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度至少为6个字符",trigger:"blur"}]},O={username:[{required:!0,message:"请选择用户名",trigger:"change"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度至少为6个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(n,e,t)=>{e!==l.password?t(new Error("两次输入的密码不一致")):t()},trigger:"blur"}]},i=w("checking"),T=async()=>{try{await k.get("/api/health",{timeout:5e3}),i.value="online",x(async()=>{const{setServerOffline:n}=await import("./index-Cvb4EdU9.js").then(e=>e.B);return{setServerOffline:n}},__vite__mapDeps([0,1])).then(({setServerOffline:n})=>{n(!1)})}catch(n){console.error("服务器连接检查失败:",n),i.value="offline",x(async()=>{const{setServerOffline:e}=await import("./index-Cvb4EdU9.js").then(t=>t.B);return{setServerOffline:e}},__vite__mapDeps([0,1])).then(({setServerOffline:e})=>{e(!0)})}};j(()=>{T()});const F=async()=>{V.value&&await V.value.validate(async n=>{var e,t;if(n)try{if(i.value==="offline"){p.warning("服务器连接失败，无法登录。请稍后再试。");return}const o=await k.post("/api/auth/login",{username:d.username,password:d.password});o.data.success&&(localStorage.setItem("token",o.data.token),localStorage.setItem("isAdmin",String(o.data.isAdmin)),localStorage.setItem("username",o.data.username),p.success(o.data.message),A.push(o.data.isAdmin?"/admin":"/dashboard"))}catch(o){o.response?p.error(((t=(e=o.response)==null?void 0:e.data)==null?void 0:t.error)||"登录失败"):(p.error("无法连接到服务器，请检查网络连接"),i.value="offline")}})},S=async()=>{g.value&&await g.value.validate(async n=>{var e,t,o;if(n)try{if(i.value==="offline"){p.warning("服务器连接失败，无法注册。请稍后再试。");return}const m=await k.post("/api/auth/register",{username:l.username,password:l.password});m.data.success&&(p.success(m.data.message),b.value="login",d.username=l.username,(e=g.value)==null||e.resetFields())}catch(m){m.response?p.error(((o=(t=m.response)==null?void 0:t.data)==null?void 0:o.error)||"注册失败"):(p.error("无法连接到服务器，请检查网络连接"),i.value="offline")}})};return(n,e)=>{const t=u("el-icon"),o=u("el-option"),m=u("el-select"),f=u("el-form-item"),h=u("el-input"),E=u("el-button"),P=u("el-form"),L=u("el-tab-pane"),K=u("el-tabs"),D=u("el-card");return c(),_("div",X,[s(D,{class:"login-card"},{header:r(()=>[e[8]||(e[8]=v("h2",null,"作业提交系统",-1)),i.value==="offline"?(c(),_("div",Y,[s(t,null,{default:r(()=>[s(U(J))]),_:1}),e[6]||(e[6]=y(" 服务器连接失败，部分功能可能不可用 "))])):i.value==="online"?(c(),_("div",Z,[s(t,null,{default:r(()=>[s(U(Q))]),_:1}),e[7]||(e[7]=y(" 服务器连接正常 "))])):H("",!0)]),default:r(()=>[s(K,{modelValue:b.value,"onUpdate:modelValue":e[5]||(e[5]=a=>b.value=a)},{default:r(()=>[s(L,{label:"登录",name:"login"},{default:r(()=>[s(P,{model:d,rules:N,ref_key:"loginFormRef",ref:V},{default:r(()=>[s(f,{prop:"username"},{default:r(()=>[s(m,{modelValue:d.username,"onUpdate:modelValue":e[0]||(e[0]=a=>d.username=a),placeholder:"请选择用户名",filterable:"",style:{width:"100%"}},{default:r(()=>[(c(),_(B,null,C(R,a=>s(o,{key:a,label:a,value:a},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),s(f,{prop:"password"},{default:r(()=>[s(h,{modelValue:d.password,"onUpdate:modelValue":e[1]||(e[1]=a=>d.password=a),type:"password",placeholder:"请输入密码","show-password":"",onKeyup:I(F,["enter"])},null,8,["modelValue"])]),_:1}),s(f,null,{default:r(()=>[s(E,{type:"primary",onClick:F,style:{width:"100%"}},{default:r(()=>e[9]||(e[9]=[y(" 登录 ")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),s(L,{label:"注册",name:"register"},{default:r(()=>[s(P,{model:l,rules:O,ref_key:"registerFormRef",ref:g},{default:r(()=>[s(f,{prop:"username"},{default:r(()=>[s(m,{modelValue:l.username,"onUpdate:modelValue":e[2]||(e[2]=a=>l.username=a),placeholder:"请选择用户名",filterable:"",style:{width:"100%"}},{default:r(()=>[(c(!0),_(B,null,C(R.filter(a=>a!=="admin"),a=>(c(),G(o,{key:a,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(f,{prop:"password"},{default:r(()=>[s(h,{modelValue:l.password,"onUpdate:modelValue":e[3]||(e[3]=a=>l.password=a),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1}),s(f,{prop:"confirmPassword"},{default:r(()=>[s(h,{modelValue:l.confirmPassword,"onUpdate:modelValue":e[4]||(e[4]=a=>l.confirmPassword=a),type:"password",placeholder:"请确认密码","show-password":"",onKeyup:I(S,["enter"])},null,8,["modelValue"])]),_:1}),s(f,null,{default:r(()=>[s(E,{type:"primary",onClick:S,style:{width:"100%"}},{default:r(()=>e[10]||(e[10]=[y(" 注册 ")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["modelValue"]),e[11]||(e[11]=v("div",{class:"login-tips"},[v("p",null,"首次登录请先选择用户名并设置密码"),v("p",null,"管理员账号：admin")],-1))]),_:1})])}}}),ae=W($,[["__scopeId","data-v-e577dd24"]]);export{ae as default};

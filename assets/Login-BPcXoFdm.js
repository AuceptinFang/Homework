const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Bz7U4b2g.js","assets/index-BPVbfOy5.css"])))=>i.map(i=>d[i]);
import{d as e,r as a,a as l,o as s,c as r,b as o,w as t,e as n,f as d,_ as u,u as i,g as m,h as p,F as f,i as c,j as g,k as v,l as w,m as _,n as h,p as y,s as b,E as V,q as k}from"./index-Bz7U4b2g.js";const S={class:"login-container"},O={key:0,class:"server-status offline"},P={key:1,class:"server-status online"},q=k(e({__name:"Login",setup(e){const k=i(),q=a(),E=a(),I=a("login"),U=["admin","段鹏鹏","方震","高天全","高子涵","龚皓","霍雨婷","贾奇燠","贾一丁","金闿翎","靳宇晨","李希","刘森源","刘文晶","吕彦儒","吕泽熙","苏宗佑","汤锦健","王奕涵","王悦琳","王志成","王墨","王泽君","夏正鑫","肖俊波","杨海屹","杨孟涵","张成宇","张峻菘","张钟文","赵萌"],A=l({username:"",password:""}),j=l({username:"",password:"",confirmPassword:""}),x={username:[{required:!0,message:"请选择用户名",trigger:"change"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度至少为6个字符",trigger:"blur"}]},F={username:[{required:!0,message:"请选择用户名",trigger:"change"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度至少为6个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(e,a,l)=>{a!==j.password?l(new Error("两次输入的密码不一致")):l()},trigger:"blur"}]},R=a("checking");s((()=>{(async()=>{try{await d.get("/health",{timeout:5e3}),R.value="online",u((async()=>{const{setServerOffline:e}=await import("./index-Bz7U4b2g.js").then((e=>e.B));return{setServerOffline:e}}),__vite__mapDeps([0,1])).then((({setServerOffline:e})=>{e(!1)}))}catch(e){R.value="offline",u((async()=>{const{setServerOffline:e}=await import("./index-Bz7U4b2g.js").then((e=>e.B));return{setServerOffline:e}}),__vite__mapDeps([0,1])).then((({setServerOffline:e})=>{e(!0)}))}})()}));const L=async()=>{q.value&&await q.value.validate((async e=>{var a,l;if(e)try{if("offline"===R.value)return void V.warning("服务器连接失败，无法登录。请稍后再试。");const e=await d.post("/auth/login",{username:A.username,password:A.password});e.data.success&&(localStorage.setItem("token",e.data.token),localStorage.setItem("isAdmin",String(e.data.isAdmin)),localStorage.setItem("username",e.data.username),V.success(e.data.message),k.push(e.data.isAdmin?"/admin":"/dashboard"))}catch(s){s.response?V.error((null==(l=null==(a=s.response)?void 0:a.data)?void 0:l.error)||"登录失败"):(V.error("无法连接到服务器，请检查网络连接"),R.value="offline")}}))},B=async()=>{E.value&&await E.value.validate((async e=>{var a,l,s;if(e)try{if("offline"===R.value)return void V.warning("服务器连接失败，无法注册。请稍后再试。");const e=await d.post("/api/auth/register",{username:j.username,password:j.password});e.data.success&&(V.success(e.data.message),I.value="login",A.username=j.username,null==(a=E.value)||a.resetFields())}catch(r){r.response?V.error((null==(s=null==(l=r.response)?void 0:l.data)?void 0:s.error)||"注册失败"):(V.error("无法连接到服务器，请检查网络连接"),R.value="offline")}}))};return(e,a)=>{const l=n("el-icon"),s=n("el-option"),d=n("el-select"),u=n("el-form-item"),i=n("el-input"),V=n("el-button"),k=n("el-form"),C=n("el-tab-pane"),D=n("el-tabs"),K=n("el-card");return m(),r("div",S,[o(K,{class:"login-card"},{header:t((()=>[a[8]||(a[8]=p("h2",null,"作业提交系统",-1)),"offline"===R.value?(m(),r("div",O,[o(l,null,{default:t((()=>[o(h(y))])),_:1}),a[6]||(a[6]=v(" 服务器连接失败，部分功能可能不可用 "))])):"online"===R.value?(m(),r("div",P,[o(l,null,{default:t((()=>[o(h(b))])),_:1}),a[7]||(a[7]=v(" 服务器连接正常 "))])):_("",!0)])),default:t((()=>[o(D,{modelValue:I.value,"onUpdate:modelValue":a[5]||(a[5]=e=>I.value=e)},{default:t((()=>[o(C,{label:"登录",name:"login"},{default:t((()=>[o(k,{model:A,rules:x,ref_key:"loginFormRef",ref:q},{default:t((()=>[o(u,{prop:"username"},{default:t((()=>[o(d,{modelValue:A.username,"onUpdate:modelValue":a[0]||(a[0]=e=>A.username=e),placeholder:"请选择用户名",filterable:"",style:{width:"100%"}},{default:t((()=>[(m(),r(f,null,c(U,(e=>o(s,{key:e,label:e,value:e},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])),_:1}),o(u,{prop:"password"},{default:t((()=>[o(i,{modelValue:A.password,"onUpdate:modelValue":a[1]||(a[1]=e=>A.password=e),type:"password",placeholder:"请输入密码","show-password":"",onKeyup:g(L,["enter"])},null,8,["modelValue"])])),_:1}),o(u,null,{default:t((()=>[o(V,{type:"primary",onClick:L,style:{width:"100%"}},{default:t((()=>a[9]||(a[9]=[v(" 登录 ")]))),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),o(C,{label:"注册",name:"register"},{default:t((()=>[o(k,{model:j,rules:F,ref_key:"registerFormRef",ref:E},{default:t((()=>[o(u,{prop:"username"},{default:t((()=>[o(d,{modelValue:j.username,"onUpdate:modelValue":a[2]||(a[2]=e=>j.username=e),placeholder:"请选择用户名",filterable:"",style:{width:"100%"}},{default:t((()=>[(m(!0),r(f,null,c(U.filter((e=>"admin"!==e)),(e=>(m(),w(s,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),o(u,{prop:"password"},{default:t((()=>[o(i,{modelValue:j.password,"onUpdate:modelValue":a[3]||(a[3]=e=>j.password=e),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])])),_:1}),o(u,{prop:"confirmPassword"},{default:t((()=>[o(i,{modelValue:j.confirmPassword,"onUpdate:modelValue":a[4]||(a[4]=e=>j.confirmPassword=e),type:"password",placeholder:"请确认密码","show-password":"",onKeyup:g(B,["enter"])},null,8,["modelValue"])])),_:1}),o(u,null,{default:t((()=>[o(V,{type:"primary",onClick:B,style:{width:"100%"}},{default:t((()=>a[10]||(a[10]=[v(" 注册 ")]))),_:1})])),_:1})])),_:1},8,["model"])])),_:1})])),_:1},8,["modelValue"]),a[11]||(a[11]=p("div",{class:"login-tips"},[p("p",null,"首次登录请先选择用户名并设置密码"),p("p",null,"管理员账号：admin")],-1))])),_:1})])}}}),[["__scopeId","data-v-4be3678d"]]);export{q as default};
